@startuml UC003_Basic_Flow_View_And_Manage
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60
skinparam sequenceParticipant underline

title UC003 - Floor Directory: Basic Flow - View and Manage

actor "Student or Guest" as Guest
actor Administrator
boundary "resources/views/guest/floors/show.blade.php" as GuestFloorShow
boundary "resources/views/admin/floors/create.blade.php" as AdminFloorView
control "app/Http/Controllers/Guest/FloorController.php" as GuestFloorController
control "app/Http/Controllers/Admin/FloorController.php" as AdminFloorController
entity "app/Models/Floor.php" as FloorModel
database "floors" as FloorDB

== Guest View Flow ==

Guest -> GuestFloorShow: GET /guest/floors/{floor}
GuestFloorShow -> GuestFloorController: show(Floor $floor)
GuestFloorController -> FloorModel: Route model binding: $floor
FloorModel -> FloorDB: SELECT * FROM floors WHERE id = ?
FloorDB --> FloorModel: Return floor record
FloorModel --> GuestFloorController: Floor object

alt Floor is Active
    GuestFloorController --> GuestFloorShow: view('guest.floors.show', compact('floor'))
    GuestFloorShow --> Guest: Display floor details with rooms and panoramas
else Floor is Inactive
    GuestFloorController -> GuestFloorController: abort(404)
end

== Admin Management Flow ==

Administrator -> AdminFloorView: POST /admin/floors (floor data)
AdminFloorView -> AdminFloorController: store(Request $request)

AdminFloorController -> AdminFloorController: $request->validate([...])

alt Validation Passes
    alt Image Upload
        AdminFloorController -> AdminFloorController: $image->move(public_path('images/floors'), $imageName)
    end
    
    AdminFloorController -> FloorModel: create($data)
    FloorModel -> FloorDB: INSERT INTO floors VALUES (...)
    FloorDB --> FloorModel: Return created record
    
    AdminFloorController --> AdminFloorView: redirect()->route('admin.floors.index')->with('success')
    AdminFloorView -> Administrator: HTTP 302 Redirect to /admin/floors
else Validation Fails
    AdminFloorController --> AdminFloorView: ValidationException with errors
    AdminFloorView -> Administrator: Display validation errors
end

@enduml
