@startuml UC002_Basic_Flow_Add_Map
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60
skinparam sequenceParticipant underline

title UC002 - Library Map Management: Basic Flow - Add Map

actor Administrator
boundary "resources/views/admin/maps/create.blade.php" as MapView
control "app/Http/Controllers/Admin/LibraryMapController.php" as MapController
entity "app/Models/LibraryMap.php" as LibraryMapModel
database "library_maps" as MapDB

Administrator -> MapView: GET /admin/maps/create
MapView --> Administrator: Display create map form

Administrator -> MapView: POST /admin/maps (map data)
MapView -> MapController: store(Request $request)

MapController -> MapController: $request->validate([...])

alt Validation Passes
    alt Set as Default
        MapController -> LibraryMapModel: where('is_default', true)->update(['is_default' => false])
        LibraryMapModel -> MapDB: UPDATE library_maps SET is_default = 0
    end
    
    MapController -> LibraryMapModel: create($validated)
    LibraryMapModel -> MapDB: INSERT INTO library_maps VALUES (...)
    MapDB --> LibraryMapModel: Return created record
    LibraryMapModel --> MapController: LibraryMap object
    
    MapController --> MapView: redirect()->route('admin.maps.index')->with('success')
    MapView -> Administrator: HTTP 302 Redirect to /admin/maps
else Validation Fails
    MapController --> MapView: ValidationException with errors
    MapView -> Administrator: Display validation errors
end

@enduml
